---
uuid: 9f578b91-d94a-12f1-c9a3-f86998cb27b8
title: 2025-11-23-canvas项目核心类型定义
category: 笔记
mathjax: false
date: 2025-11-23 15:30:00
tags:
  - 前端开发
  - TypeScript
  - 类型定义
---

## 1. 概述

本文档详细介绍了 BDdraw 项目中的核心类型定义。这些类型定义构成了整个应用程序的数据结构基础，确保了类型安全和代码的可维护性。主要涉及以下几类核心类型：

- [CanvasElement](/src/pages/canvas/Pixi_STM_modules/core/types.ts#L15-L15)：定义画布上所有元素的基本属性和可选属性
- [HandleType](/src/pages/canvas/Pixi_STM_modules/core/types.ts#L9-L9)：定义变换控制器上各种手柄的类型
- [StageManagerState](/src/pages/canvas/Pixi_STM_modules/core/types.ts#L11-L38)：管理渲染层的交互状态
- [InteractionMode](/src/pages/canvas/Pixi_STM_modules/core/types.ts#L3-L8)：定义用户与画布交互的各种模式
- [ToolType](/src/stores/canvasStore.ts#L6-L21)：定义用户可选择的工具类型

## 2. 核心类型详解

### 2.1 CanvasElement 类型

[CanvasElement](/src/pages/canvas/Pixi_STM_modules/core/types.ts#L15-L15) 接口定义了画布上所有元素的基本属性和可选属性。它是整个画布系统中最基础的数据结构。

```typescript
interface CanvasElement {
  id: string
  type: 'rect' | 'circle' | 'triangle' | 'text' | 'image' | 'line' | 'arrow' | 'pencil'
  x: number
  y: number
  width: number
  height: number
  fill: string
  stroke: string
  strokeWidth: number
  // 根据元素类型可能包含额外属性
  text?: string // 文本元素
  imageUrl?: string // 图片元素
  points?: number[][] // 线条/铅笔元素
  fontSize?: number // 文本元素
  fontFamily?: string // 文本元素
  alpha?: number // 透明度
  radius?: number // 圆角矩形
}
```

#### 2.1.1 基础属性说明

| 属性名      | 类型   | 必需 | 描述                                 |
| ----------- | ------ | ---- | ------------------------------------ |
| id          | string | 是   | 元素唯一标识符                       |
| type        | string | 是   | 元素类型，包括基本图形、文本、图像等 |
| x           | number | 是   | 元素左上角 x 坐标                    |
| y           | number | 是   | 元素左上角 y 坐标                    |
| width       | number | 是   | 元素宽度                             |
| height      | number | 是   | 元素高度                             |
| fill        | string | 是   | 填充颜色                             |
| stroke      | string | 是   | 描边颜色                             |
| strokeWidth | number | 是   | 描边宽度                             |

#### 2.1.2 可选属性说明

| 属性名     | 类型       | 适用元素类型        | 描述                       |
| ---------- | ---------- | ------------------- | -------------------------- |
| text       | string     | text                | 文本内容，可以是 HTML 格式 |
| imageUrl   | string     | image               | 图片资源的 URL             |
| points     | number[][] | line, arrow, pencil | 点坐标数组，用于线条类元素 |
| fontSize   | number     | text                | 字体大小                   |
| fontFamily | string     | text                | 字体族                     |
| alpha      | number     | all                 | 透明度值（0-1）            |
| radius     | number     | rect                | 矩形圆角半径               |

### 2.2 HandleType 类型

[HandleType](/src/pages/canvas/Pixi_STM_modules/core/types.ts#L9-L9) 定义了变换控制器上各种手柄的类型，用于元素的缩放、旋转等操作。

```typescript
type HandleType =
  | 'tl' // top-left 左上角
  | 't' // top 顶部中间
  | 'tr' // top-right 右上角
  | 'r' // right 右侧中间
  | 'br' // bottom-right 右下角
  | 'b' // bottom 底部中间
  | 'bl' // bottom-left 左下角
  | 'l' // left 左侧中间
  | 'p0' // 线段起点
  | 'p1' // 线段终点
  | 'rotate' // 旋转手柄
```

### 2.3 StageManagerState 类型

[StageManagerState](/src/pages/canvas/Pixi_STM_modules/core/types.ts#L11-L38) 接口管理渲染层的交互状态，包括当前交互模式、起始位置、选中元素等信息。

```typescript
interface StageManagerState {
  mode: InteractionMode
  startPos: { x: number; y: number }
  currentId: string | null
  initialElementsMap: Record<string, Partial<CanvasElement>> | null
  initialGroupBounds: { x: number; y: number; width: number; height: number } | null
  initialElementState: Partial<CanvasElement> | null
  resizeInitialStates: Record<string, Partial<CanvasElement>> | null
  dragInitialStates: Record<string, Partial<CanvasElement>> | null
  activeHandle: HandleType | null
  isSpacePressed: boolean
  destroyed: boolean
}
```

| 属性名                                                                        | 类型                                                            | 描述                   |
| ----------------------------------------------------------------------------- | --------------------------------------------------------------- | ---------------------- |
| mode                                                                          | [InteractionMode](                                              |
| /src/pages/canvas/Pixi_STM_modules/core/types.ts#L3-L8)             | 当前交互模式                                                    |
| startPos                                                                      | { x: number; y: number }                                        | 操作起始坐标           |
| currentId                                                                     | string \| null                                                  | 当前操作元素的 ID      |
| initialElementsMap                                                            | Record<string, Partial<[CanvasElement](                         |
| /src/pages/canvas/Pixi_STM_modules/core/types.ts#L15-L15)>> \| null | 多选时选中元素的初始状态快照                                    |
| initialGroupBounds                                                            | { x: number; y: number; width: number; height: number } \| null | 多选时群组的初始包围盒 |
| initialElementState                                                           | Partial<[CanvasElement](                                        |
| /src/pages/canvas/Pixi_STM_modules/core/types.ts#L15-L15)> \| null  | 单选时元素的初始状态                                            |
| resizeInitialStates                                                           | Record<string, Partial<[CanvasElement](                         |
| /src/pages/canvas/Pixi_STM_modules/core/types.ts#L15-L15)>> \| null | 调整大小操作的初始状态                                          |
| dragInitialStates                                                             | Record<string, Partial<[CanvasElement](                         |
| /src/pages/canvas/Pixi_STM_modules/core/types.ts#L15-L15)>> \| null | 拖拽操作的初始状态                                              |
| activeHandle                                                                  | [HandleType](                                                   |
| /src/pages/canvas/Pixi_STM_modules/core/types.ts#L9-L9) \| null     | 当前激活的手柄类型                                              |
| isSpacePressed                                                                | boolean                                                         | 空格键是否按下         |
| destroyed                                                                     | boolean                                                         | 组件是否已销毁         |

### 2.4 InteractionMode 类型

[InteractionMode](/src/pages/canvas/Pixi_STM_modules/core/types.ts#L3-L8) 定义了用户与画布交互的各种模式。

```typescript
type InteractionMode =
  | 'idle' // 空闲状态
  | 'panning' // 画布平移
  | 'selecting' // 选择元素
  | 'dragging' // 拖拽元素
  | 'resizing' // 调整元素大小
  | 'drawing' // 绘制元素
  | 'texting' // 文本编辑
  | 'erasing' // 擦除元素
```

### 2.5 ToolType 类型

[ToolType](/src/stores/canvasStore.ts#L6-L21) 定义了用户可选择的工具类型。

```typescript
type ToolType =
  | 'select' // 选择工具
  | 'rect' // 矩形工具
  | 'circle' // 圆形工具
  | 'triangle' // 三角形工具
  | 'text' // 文本工具
  | 'image' // 图片工具
  | 'line' // 直线工具
  | 'arrow' // 箭头工具
  | 'pencil' // 铅笔工具
  | 'eraser' // 橡皮擦工具
  | 'hand' // 手型工具
```

## 3. 类型间的关系

这些类型定义之间存在密切关系，共同构建了应用的状态管理系统：

1. [ToolType](/src/stores/canvasStore.ts#L6-L21) 决定了用户可以选择的工具类型
2. [CanvasElement](/src/pages/canvas/Pixi_STM_modules/core/types.ts#L15-L15) 是画布上所有元素的基础类型
3. [InteractionMode](/src/pages/canvas/Pixi_STM_modules/core/types.ts#L3-L8) 和 [HandleType](/src/pages/canvas/Pixi_STM_modules/core/types.ts#L9-L9) 控制用户交互行为
4. [StageManagerState](/src/pages/canvas/Pixi_STM_modules/core/types.ts#L11-L38) 整合所有状态信息，管理整个渲染层的运行状态
