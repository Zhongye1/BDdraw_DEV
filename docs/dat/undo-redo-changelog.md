# Undo/Redo 功能变更日志

## [v1.0.0] - 2025-11-22

### 新增功能

- 实现基于命令模式的撤销/重做功能
- 添加 UndoRedoManager 管理类，负责管理撤销/重做栈
- 添加 SnapshotCommand 命令类，用于保存状态快照
- 实现状态变更追踪机制，自动记录重要操作

### 核心特性

- 状态快照：使用 structuredClone 创建状态深拷贝
- 命令模式：通过命令对象封装撤销/重做逻辑
- 栈管理：维护独立的撤销栈和重做栈
- 锁定机制：防止在连续操作中记录过多中间状态

## [v1.0.1] - 2025-11-22

### 修复问题

- 修复图形缩放操作未正确记录到撤销/重做栈的问题
  - 确保在调整大小操作结束时正确解锁 UndoRedoManager
  - 使缩放操作能够被正确记录和撤销

## [v1.0.2] - 2025-11-22

### 改进功能

- 优化调整大小操作的解锁机制：
  - 调整大小操作完成后，延迟 0.5 秒解锁 UndoRedoManager
  - 在解锁时强制触发一次状态更新以确保调整大小操作被正确记录
  - 确保调整大小操作的状态变更被正确记录到撤销/重做栈中

## 使用说明

### 撤销操作
用户可以通过以下方式触发撤销：
- 按下 Ctrl+Z 快捷键
- 点击撤销按钮（如果界面提供）

### 重做操作
用户可以通过以下方式触发重做：
- 按下 Ctrl+Y 或 Ctrl+Shift+Z 快捷键
- 点击重做按钮（如果界面提供）

### 不会被记录的操作

以下操作不会出现在撤销/重做历史中：
1. 切换绘图工具（如从选择工具切换到矩形工具）
2. 选择元素（单选或多选）
3. 拖拽、绘制、调整大小过程中的中间状态变化

只有对画布内容产生实质性修改的操作才会被记录，例如：
- 添加新元素
- 修改元素属性（位置、大小、颜色等）
- 删除元素
- 粘贴元素