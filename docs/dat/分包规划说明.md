# BDdraw 项目分包规划说明

## 1. 项目概述

BDdraw 是一个基于 React 和 PixiJS 的在线绘图工具，支持多种图形绘制（矩形、圆形、三角形、菱形、线条、箭头、铅笔涂鸦）以及富文本编辑功能。项目采用现代化前端技术栈构建，包括 Vite、TypeScript、TailwindCSS 等。

## 2. 当前项目架构分析

### 2.1 技术栈
- 前端框架：React 18
- 构建工具：Vite
- 编程语言：TypeScript
- 图形引擎：PixiJS v8
- 状态管理：Zustand
- UI 库：TailwindCSS + Arco Design
- 富文本编辑器：TipTap
- 路由管理：React Router v6

### 2.2 主要目录结构
```
src/
├── components/           # 公共组件库
├── hooks/               # 自定义 Hooks
├── lib/                 # 工具库和常量
├── pages/               # 页面组件
├── stores/              # 状态管理
├── app.tsx             # 应用根组件
├── main.tsx            # 应用入口文件
├── router.tsx          # 路由配置
```

### 2.3 核心模块分析

#### 2.3.1 画布核心模块 (Canvas Core)
主要文件：`src/pages/canvas/Pixi_stageManager.ts`

这是整个应用的核心模块，负责：
- PixiJS 应用初始化和生命周期管理
- 画布视口(Viewport)控制
- 图形元素渲染和交互处理
- 各类工具操作实现（选择、拖拽、缩放、绘制）
- 事件监听和处理

#### 2.3.2 状态管理模块 (State Management)
主要文件：`src/stores/canvasStore.ts`

负责：
- 维护画布上所有元素的状态
- 管理当前选中工具类型
- 管理元素选中状态和编辑状态
- 提供元素增删改查的操作接口

#### 2.3.3 UI 组件模块 (UI Components)
位于 `src/components/` 目录下，包含：
- 顶部工具栏 (TopToolbar)
- 属性面板 (PropertyPanel)
- 富文本编辑器 (Richtext_editor)
- 各类图标组件

#### 2.3.4 页面路由模块 (Pages)
位于 `src/pages/` 目录下，包含：
- 首页 (Home)
- 画布页面 (Canvas)
- 关于页面 (About)

## 3. 分包规划方案

### 3.1 按功能模块划分

#### 3.1.1 核心画布包 (core-canvas)
**职责范围：**
- PixiJS 画布管理
- 图形渲染引擎
- 用户交互处理
- 视口控制

**包含文件：**
- `src/pages/canvas/Pixi_stageManager.ts`
- 相关的辅助类和工具函数

**对外接口：**
- 初始化画布实例
- 添加/删除/修改图形元素
- 设置当前工具模式
- 获取画布状态信息

#### 3.1.2 状态管理包 (state-manager)
**职责范围：**
- 维护画布元素状态
- 管理用户界面状态
- 提供状态变更操作

**包含文件：**
- `src/stores/canvasStore.ts`

**对外接口：**
- 获取当前状态快照
- 执行状态变更操作
- 订阅状态变化事件

#### 3.1.3 UI 组件包 (ui-components)
**职责范围：**
- 提供可复用的 UI 组件
- 实现统一的设计风格
- 封装常见的交互逻辑

**包含文件：**
- `src/components/ui/*`
- `src/components/canvas_toolbar/*`
- `src/components/property-panel/*`
- `src/components/Richtext_editor/*`

**对外接口：**
- 各个独立组件的导出
- 组件属性接口定义

#### 3.1.4 页面路由包 (pages-router)
**职责范围：**
- 页面组件组织
- 路由配置管理
- 页面间导航处理

**包含文件：**
- `src/pages/*`
- `src/router.tsx`
- `src/app.tsx`

**对外接口：**
- 路由配置对象
- 页面组件集合

#### 3.1.5 工具库包 (utilities)
**职责范围：**
- 通用工具函数
- 常量定义
- 环境配置

**包含文件：**
- `src/lib/*`
- `src/hooks/*`

**对外接口：**
- 工具函数集合
- 常量对象
- 自定义 Hook 函数

### 3.2 包依赖关系

```
                    +----------------+
                    |  pages-router  |
                    +--------+-------+
                             |
         +-------------------+--------------------+
         |                                        |
+--------v---------+                   +----------v---------+
|   ui-components  |                   |     core-canvas    |
+--------+---------+                   +----------+---------+
         |                                        |
         |                           +------------v-----------+
         |                           |      state-manager     |
         |                           +------------+-----------+
         |                                        |
         +------------------+---------------------+
                            |
                   +--------v--------+
                   |    utilities    |
                   +-----------------+
```

### 3.3 分包实施步骤

#### 第一阶段：基础重构
1. 提取公共类型定义到独立文件
2. 整理工具函数到统一目录
3. 明确各模块间的接口边界

#### 第二阶段：核心模块分离
1. 将 [StageManager](/src/pages/canvas/Pixi_stageManager.ts#L11-L348) 类重构为独立包
2. 抽离状态管理逻辑
3. 建立模块间通信机制

#### 第三阶段：UI 组件模块化
1. 整理现有组件为标准组件库格式
2. 统一组件接口规范
3. 提供完整的文档和示例

#### 第四阶段：完善和优化
1. 建立独立的构建和测试流程
2. 优化包间依赖关系
3. 提供完整的使用文档

## 4. 预期收益

### 4.1 开发效率提升
- 模块职责更清晰，降低理解成本
- 支持并行开发，提高团队协作效率
- 便于定位问题和调试

### 4.2 代码质量改善
- 强化接口约束，减少错误传递
- 提高代码复用率
- 更好的测试覆盖

### 4.3 可维护性增强
- 降低模块间耦合度
- 便于独立升级和替换
- 提高系统扩展性

### 4.4 可复用性提高
- 核心画布模块可在其他项目中复用
- UI 组件可形成内部组件库
- 工具函数可在多个场景下使用

## 5. 风险评估及应对措施

### 5.1 技术风险
**风险描述：** 分包过程中可能出现接口设计不合理导致返工
**应对措施：** 分阶段实施，每个阶段完成后进行充分测试和评审

### 5.2 时间风险
**风险描述：** 分包工作可能影响正常功能开发进度
**应对措施：** 制定详细计划，优先处理核心模块，非核心模块逐步完成

### 5.3 团队适应风险
**风险描述：** 团队成员需要时间适应新的项目结构
**应对措施：** 提供详细的文档和培训，设立过渡期

## 6. 总结

通过合理的分包规划，可以显著提升 BDdraw 项目的可维护性和可扩展性。按照功能职责将项目划分为核心画布、状态管理、UI 组件、页面路由和工具库五个主要模块，能够使项目结构更加清晰，有利于长期维护和发展。